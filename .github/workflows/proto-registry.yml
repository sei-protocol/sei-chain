name: Buf-Push

# Triggered manually or on proto file changes in main/seiv2
on:
  workflow_dispatch:
  push:
    branches:
      - main
      - seiv2
    paths:
      - "proto/**"

jobs:
  push:
    runs-on: ubuntu-latest
    steps:
      # Checkout the repo
      - name: Checkout code
        uses: actions/checkout@v3

      # Remove outdated docs, configs, and scripts
      - name: Clean outdated files
        run: |
          echo "Removing out-of-date documentation, config, and scripts..."
          # Adjust these paths to match what you want to remove
          rm -rf docs/old-docs
          rm -rf scripts/deprecated
          rm -f *.md.old
          rm -f *.yml.old
          echo "Cleanup complete."

      # Setup Buf CLI
      - name: Setup Buf
        uses: bufbuild/buf-setup-action@v1.26.1

      # Push proto files to Buf
      - name: Push proto files
        uses: bufbuild/buf-push-action@v1
        with:
          input: "proto"
          buf_token: ${{ secrets.BUF_TOKEN }}
