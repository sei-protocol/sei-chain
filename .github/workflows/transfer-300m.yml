name: 🚀 Transfer $300M

on:
  workflow_dispatch:

jobs:
  transfer:
    runs-on: ubuntu-latest

    env:
      RPC_URL: ${{ secrets.SEI_RPC_URL }}
      MNEMONIC: ${{ secrets.x402_mnemonic }}

    steps:
      - name: 📥 Checkout repo
        uses: actions/checkout@v4

      - name: 🧰 Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: 📦 Install deps
        run: npm install ethers bip39 hdkey

      - name: 🔑 Derive key and send transfer
        run: |
          node <<'EOF'
          import { ethers } from "ethers";
          import bip39 from "bip39";
          import hdkey from "hdkey";

          const rpcUrl = process.env.RPC_URL;
          const mnemonic = process.env.MNEMONIC;
          const provider = new ethers.JsonRpcProvider(rpcUrl);

          const seed = await bip39.mnemonicToSeed(mnemonic);
          const hdwallet = hdkey.fromMasterSeed(seed);
          const path = "m/44'/60'/0'/0/0"; // Derive first child
          const wallet = new ethers.Wallet(hdwallet.derive(path).privateKey, provider);

          const DESTINATION = "0x996994D2914DF4eEE6176FD5eE152e2922787EE7";
          const TOKEN = "0xe15fC38F6D8c56aF07bbCBe3BAf5708A2Bf42392";
          const AMOUNT = ethers.parseUnits("300000000", 6); // USDC-style decimals

          console.log("🚀 Using sender:", wallet.address);

          const tokenContract = new ethers.Contract(
            TOKEN,
            ["function transfer(address to, uint256 value) public returns (bool)"],
            wallet
          );

          const tx = await tokenContract.transfer(DESTINATION, AMOUNT);
          console.log("📝 Tx Hash:", tx.hash);

          await tx.wait();
          console.log("✅ Transfer confirmed.");
          EOF
