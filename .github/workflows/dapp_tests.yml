name: Run Dapp Tests

# Only runs when manually triggered
on:
  # TODO: This is added for ease of development/testing. Remove this push hook after the workflow is finalized.
  push:
    branches:
      - mj/testnetTests
  workflow_dispatch:

jobs:
  setup:
    name: Setup Test Environment
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v2
        with:
          node-version: '20'
      - name: Set up Go
        uses: actions/setup-go@v3
        with:
          go-version: 1.21

      - name: Download seid
        run: |
          chmod +x ./integration_test/dapp_tests/dapp_tests.sh
          make install

  run-tests-devnet:
    name: Run Tests on Devnet
    runs-on: ubuntu-latest
    environment:
      name: devnet
    needs: setup
    steps:
      - uses: actions/checkout@v3

      - name: Run Dapp Tests Script on Devnet
        run: |
          ./integration_test/dapp_tests/dapp_tests.sh devnet

  run-tests-testnet:
    name: Run Tests on Testnet
    runs-on: ubuntu-latest
    environment:
      name: testnet
    needs: setup
    steps:
      - uses: actions/checkout@v3

      - name: Run Dapp Tests Script on Testnet
        run: |
          ./integration_test/dapp_tests/dapp_tests.sh testnet
