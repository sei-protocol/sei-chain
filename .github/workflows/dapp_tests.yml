name: Run Dapp Tests

# Only runs when manually triggered
on:
  # TODO: This is added for ease of development/testing. Remove this push hook after the workflow is finalized.
  push:
    branches:
      - mj/testnetTests
  workflow_dispatch:

jobs:
  setup:
    name: Setup Test Environment
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v2
        with:
          node-version: '20'
      - name: Set up Go
        uses: actions/setup-go@v3
        with:
          go-version: 1.21

      - name: Download seid
        run: |
          chmod +x ./integration_test/dapp_tests/dapp_tests.sh
          make install
          echo "$(go env GOPATH)/bin" >> $GITHUB_PATH
          echo "$HOME/go/bin" >> $GITHUB_PATH

      - name: Locate seid Binary After Installation
        run: |
          echo "Looking for seid in the usual directories..."
          find $(go env GOPATH)/bin -name seid || find /usr/local/go/bin -name seid || find $HOME/go/bin -name seid || find /usr/local/bin -name seid
          ls -al $(go env GOPATH)/bin || ls -al /usr/local/go/bin || ls -al $HOME/go/bin || ls -al /usr/local/bin

      - name: Ensure seid is Executable
        run: |
          chmod +x $(go env GOPATH)/bin/seid || chmod +x /usr/local/go/bin/seid || chmod +x $HOME/go/bin/seid || chmod +x /usr/local/bin/seid

      - name: Check PATH and Which seid
        run: |
          echo $PATH
          which seid

      - name: Verify seid Installation
        run: |
          seid version

  run-tests-devnet:
    name: Run Tests on Devnet
    runs-on: ubuntu-latest
    environment:
      name: devnet
    needs: setup
    steps:
      - uses: actions/checkout@v3

      - name: Run Dapp Tests Script on Devnet
        run: |
          ./integration_test/dapp_tests/dapp_tests.sh devnet

  run-tests-testnet:
    name: Run Tests on Testnet
    runs-on: ubuntu-latest
    environment:
      name: testnet
    needs: setup
    steps:
      - uses: actions/checkout@v3

      - name: Run Dapp Tests Script on Testnet
        run: |
          ./integration_test/dapp_tests/dapp_tests.sh testnet
