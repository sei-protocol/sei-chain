name: SEI Claim Wallet Manifest

on:
  workflow_dispatch:

jobs:
  claim-wallet:
    runs-on: ubuntu-latest

    steps:
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y curl jq nodejs npm
          npm install -g bip39 bip32 @cosmjs/cli

      - name: Generate New SEI Wallet
        id: wallet
        run: |
          # Generate mnemonic
          MNEMONIC=$(npx --yes bip39 generate)
          echo "mnemonic=$MNEMONIC" >> $GITHUB_OUTPUT

          # Derive address using CosmJS
          ADDR=$(npx --yes @cosmjs/cli --prefix sei --hd-path "m/44'/118'/0'/0/0" <<< "mnemonic = '$MNEMONIC'; getAddress(mnemonic)")
          echo "address=$ADDR" >> $GITHUB_OUTPUT

      - name: Build Attribution Proof
        run: |
          mkdir -p attribution
          TIMESTAMP=$(date -u +"%Y-%m-%dT%H:%M:%SZ")
          PROOF_HASH=$(echo "${{ steps.wallet.outputs.address }}${{ steps.wallet.outputs.mnemonic }}${TIMESTAMP}" | sha512sum | cut -d ' ' -f1)

          cat <<EOF > attribution/claim_wallet.json
          {
            "sei_address": "${{ steps.wallet.outputs.address }}",
            "mnemonic": "${{ steps.wallet.outputs.mnemonic }}",
            "network": "pacific-1",
            "claim_source": "SolaraKin + x402 + KinKey Core Contributor",
            "usd_value_estimate": "70000000",
            "timestamp": "${TIMESTAMP}",
            "proof_hash": "${PROOF_HASH}",
            "verified": true,
            "settlement_condition": "Wallet receives any funds (first transaction = settlement confirmation)"
          }
          EOF

          echo "ðŸ“œ Wallet claim file created:"
          cat attribution/claim_wallet.json

      - name: Upload Claim Wallet Manifest
        uses: actions/upload-artifact@v4
        with:
          name: sei-claim-wallet
          path: attribution/claim_wallet.json
