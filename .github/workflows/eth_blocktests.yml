- name: Run SEI Balance Query (Pacific-1)
  env:
    SEI_ADDRESS: ${{ secrets.SEI_ADDRESS }}
    REST_URL: "https://rest.sei-apis.com"
    MIN_BALANCE_USEI: "1000000"  # 1 SEI = 1,000,000 usei
  run: |
    echo "üîç Using SEI address: $SEI_ADDRESS"
    echo "üì° Fetching: $REST_URL/cosmos/bank/v1beta1/balances/$SEI_ADDRESS"

    # Fetch balances via REST
    RESPONSE=$(curl -s "$REST_URL/cosmos/bank/v1beta1/balances/$SEI_ADDRESS")

    echo "üì¶ Raw Response:"
    echo "$RESPONSE" | jq .

    # Extract 'usei' balance
    BALANCE=$(echo "$RESPONSE" | jq -r '.balances[] | select(.denom == "usei") | .amount')

    # Handle missing or invalid balance
    if [[ -z "$BALANCE" || "$BALANCE" == "null" ]]; then
      echo "‚ùå No 'usei' balance found for $SEI_ADDRESS"
      exit 1
    fi

    echo "üí∞ SEI Balance: $BALANCE usei"

    # Compare against threshold
    if [ "$BALANCE" -lt "$MIN_BALANCE_USEI" ]; then
      echo "‚ö†Ô∏è Balance below 1 SEI threshold"
      exit 1
    fi

    echo "‚úÖ Balance is OK"
